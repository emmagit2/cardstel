<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard with Chat</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background: #f1f5f9;
    }
    
    body {
      display: flex;
    }

    #sidebar {
      width: 120px;
      background-color: #ffffff;
      padding: 1rem;
      border-right: 1px solid rgba(0, 0, 0, 0.663);
      height: 100vh;
      
      overflow-y: auto;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      margin-top: 5%;
    }

    #mainContent {
      display: flex;
      flex-grow: 1;
      height: 100vh;
      overflow: hidden;
    }

    #chatListContainer {
      width: 300px;
      padding: 1rem;
      border-right: 1px solid #dee2e6;
      overflow-y: auto;
    }

    .chat-group {
      display: none;
    }

    .chat-group.active {
      display: block;
    }

    #chatUI {
      padding: 1rem;
      margin-top: 10%;
      display: flex;
      flex-direction: column;
      height: 50%;
    }

    #messagesContainer {
      flex-grow: 1;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }

    .chatListGroup {
      list-style: none;
      padding-left: 0;
    }

    .chatListGroup li {
      padding: 5px 0;
    }

    .list-group-item {
      cursor: pointer;
    }

    .list-group-item:hover {
      background-color: #e9ecef;
    }

  #topNav {
  width: 80%;
  margin: 0 auto;
  height: 56px;
  background-color: transparent; /* no background */
  border-bottom: 1px solid #ddd; /* subtle bottom border */
  color: #1e293b; /* dark text color */
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1rem;
  position: fixed;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

  top: 0;
  left: 0;  /* needed to center with margin auto */
  right: 0;
  z-index: 1000;
  border-radius:25px; /* optional: rounded bottom corners */
  backdrop-filter: blur(8px); /* optional: nice subtle blur if transparent */
  -webkit-backdrop-filter: blur(8px);
}


    #topNav .welcome-text {
      font-weight: 600;
      font-size: 1.1rem;
    }

    #profileDropdown {
      color: #f1f5f9;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      user-select: none;
      position: relative;
    }

    #profileDropdown img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
    }

    #profileDropdown .caret {
      border-top: 5px solid #f1f5f9;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      display: inline-block;
      margin-left: 0.2rem;
    }

    #notificationBell {
      position: relative;
      font-size: 1.3rem;
      margin-right: 1rem;
      cursor: pointer;
      color: #f1f5f9;
    }

    .notif-badge {
      background-color: #ef4444;
      color: white;
      border-radius: 50%;
      font-size: 0.7rem;
      padding: 2px 6px;
      font-weight: 700;
      position: absolute;
      top: -6px;
      right: -8px;
      user-select: none;
    }
    /* Left: Chat List */
    #chatListContainer {
      width: 350px;
      margin: 5% 5px;
      background: white;
      border-radius: 8px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      height: 90%
    }

    #chatListContainer h5 {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      margin: 0;
      font-weight: 600;
    }

    #chatList {
      list-style: none;
      padding: 0;
      margin: 0;
      flex-grow: 1;
      overflow-y: auto;
    }

    #chatList li.chat-item {
      padding: 1rem;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #333;
      transition: background-color 0.2s ease;
      user-select: none;
    }

    #chatList li.chat-item:hover {
      background-color: #f3f4f6;
    }

    #chatList li.chat-item.active {
      background-color: #2563eb;
      color: white;
      font-weight: 600;
    }

#chatUI {
  width: 100%;
  max-width: 800px; /* make it more compact */
  margin: 8% auto;
  background: white;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  height: 80%;
}

#chatHeader {
  padding: 1rem;
  border-bottom: 1px solid #e2e8f0;
  font-weight: 600;
  background-color: #2563eb;
  color: white;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
}

#chatMessages {
  flex-grow: 1;
  padding: 1rem;
  overflow-y: auto;
  background-color: #f9fafb;
}

.department-card {
  transition: box-shadow 0.3s ease;
  border-left: 5px solid #0d6efd;
  border-radius: 0.5rem;
}

.department-card:hover {
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}


/* Message styling */
.chat-message {
  margin-bottom: 1rem;
  max-width: 70%;
  padding: 0.6rem 1rem;
  border-radius: 18px;
  background-color: #e0e7ff;
  font-size: 0.9rem;
  line-height: 1.4;
}

.chat-message.admin {
  background-color: #2563eb;
  color: white;
  margin-left: auto;
}

/* Chat Form Layout */
#chatForm {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  border-top: 1px solid #e2e8f0;
  padding: 0.75rem 1rem;
  background-color: #ffffff;
}

/* Icons to the left of input */
#chatForm .icon-left {
  font-size: 1.2rem;
  color: #64748b;
  cursor: pointer;
  margin-right: 0.4rem;
}

/* Input with mic icon inside */
#chatInputWrapper {
  flex-grow: 1;
  position: relative;
  display: flex;
  align-items: center;
}

#chatInput {
  width: 100%;
  border: none;
  padding: 0.6rem 2.5rem 0.6rem 1rem;
  border-radius: 25px;
  background-color: #f1f5f9;
  font-size: 0.95rem;
  outline: none;
}

#chatInput:focus {
  background-color: #e2e8f0;
}

/* Mic icon inside input */
#chatInputWrapper i.fa-microphone {
  position: absolute;
  right: 12px;
  color: #64748b;
  font-size: 1.1rem;
  cursor: pointer;
}

/* Send button */
#chatForm button {
  background-color: #2563eb;
  border: none;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.1rem;
  transition: background-color 0.2s;
}

#chatForm button:hover {
  background-color: #1e40af;
}


.admin {
  background-color: #cce5ff;
  align-self: flex-end;
  margin-left: auto;
}

.staff {
  background-color: #e2e2e2;
  align-self: flex-start;
  margin-right: auto;
}

#chatForm {
  display: flex;
  gap: 10px;
}

#messageInput {
  flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

#sendBtn {
  padding: 10px 16px;
  background: #007bff;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}
.smaal{
text-align:left;


}

  .gradient-header {
    background: linear-gradient(135deg, #1f2937, #111827); /* Dark slate gradient */
    color: #e0e7ff; /* Light bluish text for contrast */
    border-radius: 6px;
  }
  .gradient-header strong {
    font-weight: 600;
    font-size: 1.1rem;
  }
  .toggle-title i {
    transition: transform 0.3s ease;
    color: #a5b4fc; /* Soft indigo */
  }
  .toggle-title[aria-expanded="false"] i {
    transform: rotate(-90deg);
  }
  .btn-outline-success {
    color: #a5b4fc;
    border-color: #a5b4fc;
  }
  .btn-outline-success:hover, 
  .btn-outline-success:focus {
    background-color: #4f46e5;
    border-color: #4f46e5;
    color: white;
  }
 /* Online green dot */
  .online-status {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 0.75rem;
    height: 0.75rem;
    background-color: #22c55e;
    border: 2px solid #212529; /* match bg-dark border */
    border-radius: 50%;
  }

  /* Department arrow right */
  #departmentLists li::after {
    content: "\f054"; /* FontAwesome right caret */
    font-family: "Font Awesome 6 Free"; 
    font-weight: 900;
    color: #6c757d; /* bootstrap text-secondary */
    font-size: 0.9rem;
  }

  /* Arrow rotation */
  .collapsible-header i {
    transition: transform 0.3s ease;
  }
  .collapsed i {
    transform: rotate(-90deg);
  }

  .custom-bg{
color: black;
background-color:white;
  }

  .custom-boder{
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
cursor: pointer;
border-radius: 8px;
  }
  </style>
</head>
<body>

  <!-- Top Navbar -->
 <nav id="topNav" class=" border-bottom bg-white w-60 d-flex justify-content-center">
  <div class="d-flex justify-content-between align-items-center w-100" style="max-width: 80%; padding: 0.75rem 1rem;">
    <div class="welcome-text fw-semibold fs-6 text-dark">Welcome, <span id="adminName">Admin</span></div>

    <div class="d-flex align-items-center gap-3">
      <!-- Notification Bell -->
      <div id="notificationBell" class="position-relative">
        <i class="fa-solid fa-bell fs-5 text-dark"></i>
        <span class="notif-badge position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none;">3</span>
      </div>

      <!-- Profile Dropdown -->
      <div class="dropdown">
        <div id="profileDropdown" class="d-flex align-items-center gap-2 text-dark" data-bs-toggle="dropdown" style="cursor: pointer;">
          <img src="https://i.pravatar.cc/36" alt="Profile Picture" class="rounded-circle border" width="36" height="36">
          <i class="fa-solid fa-caret-down text-dark"></i> <!-- black dropdown arrow -->
        </div>

        <!-- Dropdown Menu -->
        <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded-3 mt-2">
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2" href="#">
              <i class="fa-solid fa-user text-primary"></i> Profile
            </a>
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2" href="#">
              <i class="fa-solid fa-right-from-bracket text-danger"></i> Logout
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>


  <!-- Sidebar -->
  <aside id="sidebar">
    <p class="fw-bold mb-3"><i class="fa-solid fa-house"></i> cardstel</p>

    <!-- Sidebar Navigation -->
    <ul class="list-group mb-4">
      <li class="list-group-item" onclick="showChatGroup('chatsGroup')">
        <i class="fa-solid fa-comments me-2"></i> Chats
      </li>
      <li class="list-group-item" onclick="showChatGroup('departmentsGroup')">
        <i class="fa-solid fa-building me-2"></i> Depart
      </li>
      <li class="list-group-item" onclick="showChatGroup('staffGroup')">
        <i class="fa-solid fa-user-group me-2"></i> Staff
      </li>
      <li class="list-group-item" onclick="showChatGroup('settingsGroup')">
        <i class="fa-solid fa-gear me-2"></i> Settings
      </li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main id="mainContent">
    
    <!-- Dynamic Chat List Container -->
    <div id="chatListContainer">

      <!-- Chats Group -->
      
<div class="chat-group active" id="chatsGroup">
  <h3 class="sticky-top bg-dark text-light py-2 px-3 border-bottom">Chats</h3>

  <!-- Departments -->
  <div class="chat-groups bg-secondary bg-opacity-10 rounded mb-4 p-3">
    <a 
      class="collapsible-header d-flex justify-content-between align-items-center bg-dark text-light px-3 py-2 rounded" 
      data-bs-toggle="collapse" 
      href="#collapseDepartments" 
      role="button" 
      aria-expanded="true" 
      aria-controls="collapseDepartments"
    >
      Departments
      <i class="fa fa-chevron-down"></i>
    </a>

    <div class="collapse show mt-3" id="collapseDepartments">
      <input type="text" class="searchInput form-control mb-2" data-target="departmentList" placeholder="Search departments..." />
      <ul id="departmentLis" class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center   text-dark px-2 py-2 mt-2 custom-boder">
          HR
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt- custom-boder">
          Finance
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt-2 custom-boder">
          Engineering
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt-2 custom-boder">
          Design
        </li>
      </ul>
    </div>
  </div>

<!-- Staff -->
<div class="chat-groups bg-secondary bg-opacity-10 rounded mb-4 p-3">
  <a
    class="collapsible-header d-flex justify-content-between align-items-center bg-dark text-light  px-3 py-2 rounded"
    data-bs-toggle="collapse"
    href="#collapseStaff"
    role="button"
    aria-expanded="true"
    aria-controls="collapseStaff"
  >
    Staff
    <i class="fa fa-chevron-down"></i>
  </a>
  <div class="collapse show mt-3" id="collapseStaff">
    <input type="text" class="searchInput form-control mb-2" data-target="staffList" placeholder="Search staff..." />
    <ul id="staffList" class="list-group list-group-flush"></ul>
  </div>
</div>

<!-- Admin -->
<div class="chat-groups bg-secondary bg-opacity-10 rounded mb-4 p-3">
  <a
    class="collapsible-header d-flex justify-content-between align-items-center bg-dark text-light  px-3 py-2 rounded"
    data-bs-toggle="collapse"
    href="#collapseAdmin"
    role="button"
    aria-expanded="true"
    aria-controls="collapseAdmin"
  >
    Admins
    <i class="fa fa-chevron-down"></i>
  </a>
  <div class="collapse show mt-3" id="collapseAdmin">
    <input type="text" class="searchInput form-control mb-2" data-target="adminList" placeholder="Search admins..." />
    <ul id="adminList" class="list-group list-group-flush"></ul>
  </div>
</div>


</div>



      <!-- Departments Group -->
    <!-- Departments Group -->
<div class="chat-group bg-secondary bg-opacity-10 rounded mb-4 p-3" id="departmentsGroup">
  <div class="d-flex justify-content-between align-items-center bg-dark text-light px-3 py-2 rounded collapsible-header" data-bs-toggle="collapse" href="#collapseDepartments" role="button" aria-expanded="true" aria-controls="collapseDepartments">
    <span>Departments</span>
    <div class="d-flex align-items-center gap-2">
      <button id="addDepartmentBtn" class="btn btn-sm btn-outline-light">+ Add</button>
      <i class="fa fa-chevron-down"></i>
    </div>
  </div>

  <div class="collapse show mt-3" id="collapseDepartments">
    <input type="text" class="searchInput form-control mb-2" data-target="departmentList" placeholder="Search departments..." />
     <ul id="departmentList" class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center   text-dark px-2 py-2 mt-2 custom-boder">
          HR
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt- custom-boder">
          Finance
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt-2 custom-boder">
          Engineering
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center  text-dark px-2 py-2 mt-2 custom-boder">
          Design
        </li>
      </ul>
  
  </div>
</div>


      <!-- Staff Group -->
<div class="chat-group" id="staffGroup">
  <div class="d-flex align-items-center justify-content-between gradient-header px-3 py-2">
    <div class="toggle-title" data-bs-toggle="collapse" data-bs-target="#collapseStaff" aria-expanded="true" aria-controls="collapseStaff">
      <strong>Staff</strong>
      <i class="fa fa-chevron-down ms-2"></i>
    </div>
    <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#addStaffModal">+ Add</button>
  </div>

  <div class="collapse show" id="collapseStaff">
    <div class="px-3 pb-3 pt-2 custom-scroll">
      <input type="text" class="searchInput form-control mb-3" data-target="staffList" placeholder="Search staff..." />
      <ul id="staffShow" class="list-unstyled">

 
      </ul>
    </div>
  </div>

<div class="d-flex align-items-center justify-content-between gradient-header px-3 py-2">
  <div 
    class="toggle-title d-flex align-items-center" 
    role="button" 
    data-bs-toggle="collapse" 
    data-bs-target="#collapseAdmins" 
    aria-expanded="true" 
    aria-controls="collapseAdmins"
    style="cursor: pointer;"
  >
    <strong>Admins</strong>
    <i class="fa fa-chevron-down ms-2"></i>
  </div>
  <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#addAdminModal">+ Add</button>
</div>

  <div class="collapse show" id="collapseAdmins">
  <div class="px-3 pb-3 pt-2 custom-scroll">
    <input type="text" class="searchInput form-control mb-3" placeholder="Search admins..." />
    <ul id="adminShow" class="list-unstyled">
      
     
    </ul>
  </div>
</div>

</div>

<!-- Suspend Modal -->
<div class="modal fade" id="suspendModal" tabindex="-1" aria-labelledby="suspendModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="suspendModalLabel">Suspend Staff</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to suspend this staff member?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning btn-sm">Suspend</button>
      </div>
    </div>
  </div>
</div>

<!-- Assign Admin Modal -->
<div class="modal fade" id="assignAdminModal" tabindex="-1" aria-labelledby="assignAdminModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="assignAdminModalLabel">Assign as Admin</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Do you want to assign this staff member as an admin?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-info btn-sm">Assign</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Delete Staff</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        This action is permanent. Are you sure?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger btn-sm">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Suspend Modal -->
<div class="modal fade" id="suspendModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">Suspend Admin</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to suspend this admin?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-warning btn-sm">Suspend</button>
      </div>
    </div>
  </div>
</div>

<!-- Remove Admin Modal -->
<div class="modal fade" id="removeAdminModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">Remove Admin</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Confirm removing this admin from the system?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger btn-sm">Remove</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal (Shared) -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">Delete User</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this user?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger btn-sm">Delete</button>
      </div>
    </div>
  </div>
</div>






      <!-- Settings Group -->
      <div class="chat-group" id="settingsGroup">
        <label>Settings</label>
        <p class="text-muted">Settings options will appear here.</p>
      </div>
    </div>

    <!-- Right Chat UI -->



    <div id="chatUI">
      <div id="chatHeader">Chat with</div>
      <div id="chatMessages"></div>
      <!-- <form id="chatForm">
        <input type="text" id="chatInput" placeholder="Type a message..." />
        <button type="submit" class="btn btn-primary">Send</button>
      </form> -->

      <form id="chatForm">
  <!-- Left icons -->
  <i class="fa fa-paperclip icon-left"></i>
  <i class="fa fa-smile icon-left"></i>

  <!-- Input wrapper with mic inside -->
  <div id="chatInputWrapper">
    <input type="text" id="chatInput" placeholder="Type a message..." />
    <i class="fa fa-microphone"></i>
  </div>

  <!-- Send button -->
  <button type="submit"><i class="fa fa-paper-plane"></i></button>
</form>

    </div>

  </main>



<!-- Modal for Adding Staff (with registration link email) -->
<div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="addStaffForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addStaffModalLabel">Add New Staff</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="staffEmail" class="form-label">Email</label>
          <input type="email" class="form-control" id="staffEmail" name="email" required />
        </div>
        <div class="mb-3">
          <label for="staffRole" class="form-label">Role</label>
          <select class="form-select" id="staffRole" name="role" required>
            <option value="staff">Staff</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      <div class="mb-3">
  <label for="staffDepartment" class="form-label">Department (optional)</label>
  <select class="form-select" id="staffDepartment" name="department_id">
    <option value="">-- None --</option>
  </select>
</div>

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Send Invite</button>
      </div>
    </form>
  </div>
</div>
<!-- Add Department Modal -->
<div class="modal fade" id="addDepartmentModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="addDepartmentForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Department</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control" id="newDeptName" placeholder="Enter department name" required />
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Department Modal -->
<div class="modal fade" id="editDepartmentModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="editDepartmentForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Department</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control" id="editDeptName" required />
        <input type="hidden" id="editDeptId" />
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">Update</button>
      </div>
    </form>
  </div>
</div>

<!-- Assign Staff Modal -->
<div class="modal fade" id="assignModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="assignForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Assign Staff</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="assignDeptId" />
        <input type="email" class="form-control" id="assignEmail" placeholder="Staff email" required />
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-info">Assign</button>
      </div>
    </form>
  </div>
</div>

<!-- Reusable Success Toast Message -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="successToastBody">
        Operation successful!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>
<!-- Error Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="errorToastBody">
        An error occurred.
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>




  <!-- Bootstrap JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <!-- Add these in your HTML <head> or before </body> -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>


<script>
  // âœ… Toast Helpers
  function showSuccess(message = "Success!") {
    document.getElementById('successToastBody').textContent = message;
    new bootstrap.Toast(document.getElementById('successToast')).show();
  }

  function showError(message = "Something went wrong.") {
    document.getElementById('errorToastBody').textContent = message;
    new bootstrap.Toast(document.getElementById('errorToast')).show();
  }

  // ðŸ“‚ Populate Department Dropdown
  async function populateDepartmentDropdown() {
    try {
      const res = await fetch('/api/departments');
      const departments = await res.json();

      const select = document.getElementById('staffDepartment');
      select.innerHTML = '<option value="">-- None --</option>';

      departments.forEach(dept => {
        const option = document.createElement('option');
        option.value = dept.id;
        option.textContent = dept.name;
        select.appendChild(option);
      });
    } catch (err) {
      console.error("Failed to load departments:", err);
    }
  }

  // ðŸ§© Load departments when modal is shown
  const addStaffModal = document.getElementById('addStaffModal');
  addStaffModal.addEventListener('show.bs.modal', populateDepartmentDropdown);

  // ðŸ‘¤ Handle Add Staff Form Submission
  document.getElementById('addStaffForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const email = document.getElementById('staffEmail').value.trim();
    const role = document.getElementById('staffRole').value;
    const department_id = document.getElementById('staffDepartment').value || null;

    try {
      const response = await fetch('/api/staff/invite', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, role, department_id })
      });

      const resultText = await response.text();
      let result;
      try {
        result = JSON.parse(resultText);
      } catch (jsonError) {
        throw new Error('Server returned non-JSON: ' + resultText.slice(0, 100));
      }

      if (response.ok) {
        showSuccess("Invitation email sent successfully!");
        document.getElementById('addStaffForm').reset();
        const modal = bootstrap.Modal.getInstance(document.getElementById('addStaffModal'));
        modal.hide();
      } else {
        const errorMessage = result.error || result.message || 'Something went wrong';
        alert('Error: ' + errorMessage);
      }

    } catch (err) {
      alert('Network or unexpected error: ' + err.message);
      console.error(err);
    }
  });
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBCnkHghVzYEKhYMncwLQ-IlGLVbfIJt9U",
    authDomain: "chat-app-6776e.firebaseapp.com",
    projectId: "chat-app-6776e",
    storageBucket: "chat-app-6776e.firebasestorage.app",
    messagingSenderId: "136411415099",
    appId: "1:136411415099:web:37f7c2c9cb4431db27121e",
    measurementId: "G-GVS3VG6Y50"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  let socket;
  let currentUserId = null;
  let currentChatType = null; // 'private' or 'department'
  let currentChatId = null;

  const departmentLis = document.getElementById('departmentLis');
  const staffList = document.getElementById('staffList');
  const adminList = document.getElementById('adminList');

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "/login";
      return;
    }

    currentUserId = user.uid;
    const token = await user.getIdToken();

    socket = io('https://cardstel.onrender.com', { auth: { token } });
socket.on('connect', () => {
  console.log('âœ… Connected');
  socket.emit('joinRoom', currentUserId);  // ðŸ”§ <--- Add this line!
});
  socket.on('chat message', handleIncomingMessage);

    await loadAndRenderUsers();
    await loadAndRenderDepartments();
    setupChatForm();
  });

  function handleIncomingMessage(data) {
    const isRelevant = (
      currentChatType === 'private' &&
      (
        (data.sender_id === currentChatId && data.receiver_id === currentUserId) ||
        (data.sender_id === currentUserId && data.receiver_id === currentChatId)
      )
    ) || (
      currentChatType === 'department' &&
      data.type === 'department' &&
      data.department_id === currentChatId
    );

    if (!isRelevant) return;

    appendMessage({
      ...data,
      isSelf: data.sender_id === currentUserId
    });
  }

  function setupChatForm() {
    document.getElementById('chatForm').addEventListener('submit', (e) => {
      e.preventDefault();

      const input = document.getElementById('chatInput');
      const msg = input.value.trim();
      if (!msg || !currentChatId || !currentChatType) return;

      const messageData = {
        content: msg,
        chat_type: currentChatType, // âœ… correct key name
        sender_id: currentUserId,
        receiver_id: currentChatType === 'private' ? currentChatId : null,
        department_id: currentChatType === 'department' ? currentChatId : null
      };

      socket.emit('chat message', messageData);
      appendMessage({ ...messageData, isSelf: true });
      input.value = '';
    });
  }

  async function loadAndRenderDepartments() {
    const res = await fetch('/api/departments');
    const departments = await res.json();

    departmentLis.innerHTML = '';

    departments.forEach(dept => {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.textContent = dept.name;
      li.style.cursor = 'pointer';

      li.addEventListener('click', () => {
        clearActive();
        li.classList.add('active');
        currentChatType = 'department';
        currentChatId = dept.id;
        document.getElementById('chatHeader').textContent = `Dept: ${dept.name}`;
        document.getElementById('chatMessages').innerHTML = '';
        loadChatMessages(currentChatType, currentChatId);
      });

      departmentLis.appendChild(li);
    });
  }

  async function loadAndRenderUsers() {
    const res = await fetch('/api/staff/all');
    const users = await res.json();

    staffList.innerHTML = '';
    adminList.innerHTML = '';

    const admins = users.filter(u => u.role === 'admin');
    const staff = users.filter(u => u.role !== 'admin');

    function createUserItem(user) {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.style.cursor = 'pointer';
      li.innerHTML = `
        <img src="https://i.pravatar.cc/36?u=${user.firebase_uid}" class="rounded-circle me-2" />
        <span>${user.name}</span>
      `;

      li.addEventListener('click', () => {
        clearActive();
        li.classList.add('active');
        currentChatType = 'private';
        currentChatId = user.id;
        document.getElementById('chatHeader').textContent = user.name;
        document.getElementById('chatMessages').innerHTML = '';
        loadChatMessages('private', user.id);
      });

      return li;
    }

    admins.forEach(a => adminList.appendChild(createUserItem(a)));
    staff.forEach(s => staffList.appendChild(createUserItem(s)));

    const first = admins[0] || staff[0];
    if (first) {
      const selector = first.role === 'admin' ? adminList : staffList;
      const li = selector.querySelector('li');
      li.click();
    }
  }

  function clearActive() {
    document.querySelectorAll('#staffList li, #adminList li, #departmentLis li').forEach(el => {
      el.classList.remove('active');
    });
  }

  async function loadChatMessages(type, id) {
    let url = '/api/messages?';
    url += type === 'private'
      ? `type=private&user_id=${id}`
      : `type=department&department_id=${id}`;

    const res = await fetch(url);
    const messages = await res.json();

    document.getElementById('chatMessages').innerHTML = '';

    messages.forEach(msg => {
      appendMessage({
        ...msg,
        isSelf: msg.sender_id === currentUserId
      });
    });
  }

  function appendMessage(data) {
    const chatMessages = document.getElementById('chatMessages');

    const wrapper = document.createElement('div');
    wrapper.className = data.isSelf ? 'text-end mb-2' : 'text-start mb-2';

    wrapper.innerHTML = `
      <div class="${data.isSelf ? 'bg-primary text-white' : 'bg-light text-dark'} p-2 rounded smaal">
        ${!data.isSelf && data.sender_name ? `<div class="small fw-bold">${data.sender_name}</div>` : ''}
        ${data.content}
      </div>
      <small class="text-muted">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</small>
    `;

    chatMessages.appendChild(wrapper);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
</script>

 <script>
    function showChatGroup(groupId) {
      document.querySelectorAll('.chat-group').forEach(group => {
        group.classList.remove('active');
      });
      document.getElementById(groupId).classList.add('active');
    }
  </script>


  
  <script>
    // Sample user data
    const adminName = "Admin";

    // Set admin name in top nav
    document.getElementById('adminName').textContent = adminName;
const staffDepartmentSelect = document.getElementById('staffDepartment');
const departmentList = document.getElementById('departmentList');

const API_BASE = window.location.hostname === 'localhost'
  ? 'http://localhost:5000/api/departments'
  : 'https://cardstel.onrender.com/api/departments';

// Load departments from backend and display them
async function loadDepartments() {
  try {
    const res = await fetch(API_BASE);
    const departments = await res.json();

    // Clear previous content
    staffDepartmentSelect.innerHTML = '';
    departmentList.innerHTML = '';

    departments.forEach(dep => renderDepartment(dep));
  } catch (err) {
    console.error('Failed to load departments:', err);
  }
}

// Render a department item into both the list and dropdown
function renderDepartment(dept) {
  // Card container (LI element styled like a card)
  const li = document.createElement('li');
  li.className = "card shadow-sm p-3 mb-3 border-0 department-card";
  li.dataset.deptId = dept.id;

  // Card body row layout
  const row = document.createElement('div');
  row.className = 'd-flex justify-content-between align-items-center';

  // Left: Department name
  const nameDiv = document.createElement('div');
  nameDiv.className = 'd-flex align-items-center gap-2';
  nameDiv.innerHTML = `<i class="fas fa-building text-dark fs-5"></i><span class="fw-semibold fs-6">${dept.name}</span>`;

  // Right: Action icons
  const btnGroup = document.createElement('div');
  btnGroup.className = 'd-flex gap-2';

  // Edit button
  const btnEdit = document.createElement('button');
  btnEdit.className = "btn btn-sm btn-outline-warning rounded-circle";
  btnEdit.title = "Edit";
  btnEdit.innerHTML = '<i class="fas fa-pen"></i>';
  btnEdit.addEventListener('click', () => {
    document.getElementById('editDeptName').value = dept.name;
    document.getElementById('editDeptId').value = dept.id;
    new bootstrap.Modal(document.getElementById('editDepartmentModal')).show();
  });

  // Assign button
  const btnAssign = document.createElement('button');
  btnAssign.className = "btn btn-sm btn-outline-primary rounded-circle";
  btnAssign.title = "Assign Staff";
  btnAssign.innerHTML = '<i class="fas fa-user-plus"></i>';
  btnAssign.addEventListener('click', () => {
    document.getElementById('assignDeptId').value = dept.id;
    document.getElementById('assignEmail').value = '';
    new bootstrap.Modal(document.getElementById('assignModal')).show();
  });

  // Delete button
  const btnRemove = document.createElement('button');
  btnRemove.className = "btn btn-sm btn-outline-danger rounded-circle";
  btnRemove.title = "Delete";
  btnRemove.innerHTML = '<i class="fas fa-trash"></i>';
  btnRemove.addEventListener('click', async () => {
    if (confirm(`Delete "${dept.name}"?`)) {
      try {
        await fetch(`${API_BASE}/${dept.id}`, { method: 'DELETE' });
        li.remove();
        const optionToRemove = staffDepartmentSelect.querySelector(`option[value="${dept.id}"]`);
        if (optionToRemove) optionToRemove.remove();
      } catch (err) {
        console.error('Error deleting department:', err);
      }
    }
  });

  // Append buttons to group
  btnGroup.append(btnEdit, btnAssign, btnRemove);

  // Assemble the row
  row.appendChild(nameDiv);
  row.appendChild(btnGroup);

  // Add row to card (li)
  li.appendChild(row);

  // Append the card to the list
  departmentList.appendChild(li);

  // Add to dropdown
  const option = document.createElement('option');
  option.value = dept.id;
  option.textContent = dept.name;
  staffDepartmentSelect.appendChild(option);
}


// Add new department
document.getElementById('addDepartmentForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const name = document.getElementById('newDeptName').value.trim();
  if (!name) return showError("Department name is required.");

  try {
    const res = await fetch(API_BASE, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    });

    const data = await res.json();

    if (res.ok) {
      renderDepartment(data);
      bootstrap.Modal.getInstance(document.getElementById('addDepartmentModal')).hide();
      showSuccess("Department added successfully!");
    } else {
      showError(data.message || "Failed to add department.");
    }
  } catch (err) {
    console.error("Add department error:", err);
    showError("Network error. Please try again.");
  }
});

// Edit department
document.getElementById('editDepartmentForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const id = document.getElementById('editDeptId').value;
  const name = document.getElementById('editDeptName').value.trim();
  if (!name) return showError("Department name cannot be empty.");

  try {
    const res = await fetch(`${API_BASE}/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    });

    const data = await res.json();

    if (res.ok) {
      await loadDepartments();
      bootstrap.Modal.getInstance(document.getElementById('editDepartmentModal')).hide();
      showSuccess("Department updated successfully!");
    } else {
      showError(data.message || 'Failed to update department');
    }
  } catch (err) {
    console.error("Update error:", err);
    showError("Network error. Please try again.");
  }
});

// Assign staff
document.getElementById('assignForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const email = document.getElementById('assignEmail').value.trim();
  const department_id = document.getElementById('assignDeptId').value;

  if (!email || !department_id) return showError("Both email and department are required.");

  try {
    const res = await fetch('/api/staff-assign', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, department_id })
    });

    const data = await res.json();

    if (res.ok) {
      showSuccess("Staff assigned successfully!");
      bootstrap.Modal.getInstance(document.getElementById('assignModal')).hide();
    } else {
      showError(data.message || "Failed to assign staff.");
    }
  } catch (err) {
    console.error("Assignment error:", err);
    showError("Network error. Please try again.");
  }
});

// Show Add Department modal
document.getElementById('addDepartmentBtn').addEventListener('click', () => {
  document.getElementById('newDeptName').value = '';
  new bootstrap.Modal(document.getElementById('addDepartmentModal')).show();
});

// Init
window.addEventListener('DOMContentLoaded', loadDepartments);
// Render a user card (staff or admin)
function renderUser(user, container) {
  let profileImg = `https://i.pravatar.cc/40?u=${user.firebase_uid}`;

  if (user.profile_picture?.data) {
    try {
      const bufferData = user.profile_picture.data;
      const pathStr = new TextDecoder().decode(new Uint8Array(bufferData));
      profileImg = pathStr.startsWith('/uploads') ? pathStr : `/${pathStr}`;
    } catch (err) {
      console.warn("Failed to decode profile picture path:", err);
    }
  }

  const li = document.createElement("li");
  li.className = "staff-item d-flex justify-content-between align-items-center py-2 border-bottom";
  li.innerHTML = `
    <div class="d-flex align-items-center">
      <img src="${profileImg}" class="rounded-circle me-2" alt="Profile" width="40" height="40" />
      <span class="staff-name">${user.name}</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm btn-outline-light" title="Edit"><i class="fa fa-pen"></i></button>
      <button class="btn btn-sm btn-outline-danger" title="Delete"><i class="fa fa-trash"></i></button>
      <div class="dropdown">
        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <i class="fa fa-ellipsis-vertical"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item text-warning" data-bs-toggle="modal" data-bs-target="#suspendModal">Suspend</a></li>
          ${
            user.role === "staff"
              ? `<li><a class="dropdown-item text-info" data-bs-toggle="modal" data-bs-target="#assignAdminModal">Assign as Admin</a></li>`
              : `<li><a class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#removeAdminModal">Remove Admin</a></li>`
          }
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</a></li>
        </ul>
      </div>
    </div>
  `;
  container.appendChild(li);
}

// Load users and categorize into staff/admin
async function loadUsers() {
  try {
    const res = await fetch('https://cardstel.onrender.com/api/staff/all');
    const users = await res.json();

    const staffList = document.getElementById('staffShow');
    const adminList = document.getElementById('adminShow');

    if (!staffList || !adminList) {
      console.error("Missing #staffShow or #adminShow in HTML.");
      return;
    }

    // Clear existing
    staffList.innerHTML = '';
    adminList.innerHTML = '';

    // Separate staff and admin users
    const staffUsers = users.filter(u => u.role === 'staff');
    const adminUsers = users.filter(u => u.role === 'admin');

    // Render users or fallback message
    if (staffUsers.length > 0) {
      staffUsers.forEach(user => renderUser(user, staffList));
    } else {
      staffList.innerHTML = `<li class="text-muted text-center py-2">No added staff.</li>`;
    }

    if (adminUsers.length > 0) {
      adminUsers.forEach(user => renderUser(user, adminList));
    } else {
      adminList.innerHTML = `<li class="text-muted text-center py-2">No added admin.</li>`;
    }

  } catch (err) {
    console.error("Failed to load users:", err);
  }
}

loadUsers();
  </script>
</body>
</html>
